(()=>{"use strict";const t=window.wc.blocksCheckout,e=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"contribuinte-checkout/checkout-block","version":"0.1.0","title":"Checkout block","category":"contribuinte-checkout-category","description":"Add fiscal section to checkout.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-fields-block"],"attributes":{"lock":{"type":"object"},"showStepNumber":{"type":"boolean"},"sectionTitle":{"type":"string"},"sectionDescription":{"type":"string"},"inputLabel":{"type":"string"}},"textdomain":"contribuinte-checkout"}'),i=window.React,n=window.wp.data,o=window.wp.element,c=window.wc.wcSettings,r=window.wc.blocksComponents,a=window.wc.wcBlocksData,s=window.wp.i18n,l={vat:(0,s.__)("VAT","contribuinte-checkout"),optional:(0,s.__)("(Optional)","contribuinte-checkout"),fiscalDetails:(0,s.__)("Fiscal details","contribuinte-checkout"),enterValidVat:(0,s.__)("Please enter a valid VAT number","contribuinte-checkout"),manageSettings:(0,s.__)("Manage field settings","contribuinte-checkout"),manageSettingsDescription:(0,s.__)("Options that control this section can be managed in the plugin settings page.","contribuinte-checkout"),behaviourOptions:(0,s.__)("Behaviour Options","contribuinte-checkout"),fieldLabel:(0,s.__)("Field label","contribuinte-checkout"),sectionDescription:(0,s.__)("Section description","contribuinte-checkout"),sectionTitle:(0,s.__)("Section title","contribuinte-checkout"),visualOptions:(0,s.__)("Visual Options","contribuinte-checkout"),debug:(0,s.__)("Debug","contribuinte-checkout")},u={showStepNumber:!0,sectionTitle:l.fiscalDetails,sectionDescription:"",inputLabel:l.vat},{drop_down_is_required:p,drop_down_required_over_limit_price:d,drop_down_validate_vat:b,drop_down_on_validation_fail:_}=(0,c.getSetting)("contribuinte-checkout_data","");(0,t.registerCheckoutBlock)({metadata:e,component:e=>{const{extensions:c,checkoutExtensionData:s,showStepNumber:h,sectionTitle:w,sectionDescription:g,inputLabel:k}=e,{setExtensionData:m}=s,S=(0,n.useSelect)((t=>t(a.CHECKOUT_STORE_KEY)?.isProcessing()),[]),f=(0,n.useSelect)((t=>t(a.CART_STORE_KEY)?.getCartTotals()),[]),T=(0,n.useSelect)((t=>t(a.CART_STORE_KEY)?.getCustomerData()),[]),v=(0,o.useMemo)((()=>{try{return c["contribuinte-checkout"].billingVat||""}catch(t){return""}}),[]),[V,y]=(0,o.useState)(v),C=(0,o.useMemo)((()=>{if(p)return!0;if(!d)return!1;let t=0;try{t=f?.total_price||0}catch(t){}return t>1e5}),[f]),D=(0,o.useMemo)((()=>{let t="";try{t=T?.billingAddress?.country||""}catch(t){}let e=V.toString().trim();return"PT"!==t||(t=>{if(9!==t.length)return!1;if(!/^\d+$/.test(t))return!1;let e=t.split("").map(Number),i=0;for(let t=0;t<8;t++)i+=e[t]*(9-t);let n=i%11;return(0===n?0:11-n)===e[8]})(e)}),[V,T]),E=(0,o.useCallback)((t=>!(b&&!D&&!_&&(t.setCustomValidity(l.enterValidVat),1))),[D]);return(0,o.useEffect)((()=>{m("contribuinte-checkout","billingVat",V)}),[V,m]),(0,i.createElement)(r.FormStep,{id:"fiscal-details",disabled:S,title:w&&""!==w?w:u.sectionTitle,description:g||u.sectionDescription,showStepNumber:"true"===(h||u.showStepNumber||"true").toString()},(0,i.createElement)(t.ValidatedTextInput,{id:"billing_vat",errorId:"billing_vat",type:"text",value:V,showError:!0,validateOnMount:!0,onChange:y,customValidation:E,required:C,errorMessage:_&&!D&&""!==V?l.enterValidVat:"",label:`${k&&""!==k?k:u.inputLabel} ${C?"":l.optional}`}))}})})();